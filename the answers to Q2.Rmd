---
title: "the answer to Q2"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


(a) Do both operation types migrate similarly over time?

A: According to paired t-test, both both operation types do not migrate similarl.

```{r}
DATA$Month.f <- factor(DATA$FU.Months, levels = c(0,3,12,24,60))
DATA$Type.f <- factor(DATA$Type, levels = c(1,2))

t.test(nMTPM~Type.f,data = DATA, paired = TRUE)


```
(b) Report the differences in the mean migration between the two operation types at each time point and make statistical inference.

```{r}
model1 <- gls(nMTPM ~ FU.Months*Type.f,
               data = DATA,
               correlation = corCompSymm(form = ~ FU.Months | ID),
               weights =  varExp(form = ~ FU.Months),
               na.action = na.exclude, method = "REML")
summary(model1)

model2 <- gls(nMTPM ~ Month.f*Type.f,
               data = DATA,
               correlation = corCompSymm(form = ~ FU.Months | ID),
               weights =  varExp(form = ~ FU.Months),
               na.action = na.exclude, method = "REML")
summary(model2)


```

c) Report the size of the migration change from 3 months to 1 year, 3 months to 2 years, 3 months 5 years and change from 1 year to 5 years per operation type and make statistical inference. Give the corresponding 95% confidence interval and p-value.

A:the astimated rate change in type1 group is 0.00798, and 95% intervar is(0.005115998 0.010844256)

```{r}
model1 <- gls(nMTPM ~ FU.Months*Type.f,
               data = DATA,
               correlation = corCompSymm(form = ~ FU.Months | ID),
               weights =  varExp(form = ~ FU.Months),
               na.action = na.exclude, method = "REML")
summary(model1)

#type 1 change rate
type_1est <- summary(model1)$tTable["FU.Months","Value"]
type_1upp <- type_1est +
        1.96*summary(model1)$tTable["FU.Months","Std.Error"] 
type_1low <- type_1est -
        1.96*summary(model1)$tTable["FU.Months","Std.Error"] 
type_1inter <-c(type_1low, type_1upp)
type_1inter

library(aod)
w.test1 <- wald.test(b = coef(model1),
                     Sigma = vcov(model1),
                     L = rbind(c(0,1,0,0)))
w.test1

#type 2 change rate 
betas <-coef(model1)
V <-vcov(model1)
L <-c(0,1,0,1)
type_2est <- c(L %*% betas)
ses <- sqrt(L %*% V %*% L)

type_2upp <-est + 1.96*ses
type_2low <-est - 1.96*ses
type_2inter <- c(type_2low,type_2upp)
type_2inter

w.test2 <- wald.test(b = coef(model1),
                     Sigma = vcov(model1),
                     L = rbind(c(0,1,0,1)))
w.test2

#type 1 migration change
type_1m31 <- type_1est*(12-3)
type_1m32 <- type_1est*(24-3)
type_1m35 <- type_1est*(60-3)
type_1m15 <- type_1est*(60-12)

#type 2 migration change
type_2m31 <- type_2est*(12-3)
type_2m32 <- type_2est*(24-3)
type_2m35 <- type_2est*(60-3)
type_2m15 <- type_2est*(60-12)

```

(d)Are these changes different between the two types? Give the corresponding 95% confidence interval and p-value

```{r}
Diff_type1 <-c(type_1m31,type_1m32,type_1m35,type_1m15)
Diff_type2 <-c(type_2m31,type_2m32,type_2m35,type_2m15)

t.test(Diff_type1 -Diff_type2)
```


